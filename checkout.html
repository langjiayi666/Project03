<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»“ç®— - å°å…”é²œå„¿</title>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/checkout.css">
</head>
<body>
    <!-- å¿«æ·å¯¼èˆªæ  -->
    <div class="bar">
        <div class="wrapper">
            <ul>
                <li><a href="#">25è®¡ç§‘ä¸“å‡æœ¬2ç­ æµªä½³æ€¡ 25216950207</a></li>
                <li><a href="index.html">è¿”å›é¦–é¡µ</a></li>
            </ul>
        </div>
    </div>

    <!-- å¤´éƒ¨ -->
    <div class="header wrapper">
        <div class="logo">
            <h1><a href="index.html">å°å…”é²œå„¿</a></h1>
        </div>
        <div class="nav">
            <ul>
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="#">ç”Ÿé²œ</a></li>
                <li><a href="#">ç¾é£Ÿ</a></li>
            </ul>
        </div>
        <a href="cart.html" class="car">
            <span>0</span>
        </a>
    </div>

    <!-- ç»“ç®—åŒºåŸŸ -->
    <div class="checkout-container">
        <div class="wrapper">
            <div class="checkout-title">
                <span class="step active">1. ç¡®è®¤è®¢å•</span>
                <span class="step-arrow">â€º</span>
                <span class="step active">2. æ”¯ä»˜</span>
                <span class="step-arrow">â€º</span>
                <span class="step">3. å®Œæˆ</span>
            </div>
            
            <!-- è®¢å•ä¿¡æ¯ -->
            <div class="checkout-section">
                <h3>è®¢å•ä¿¡æ¯</h3>
                <div id="orderSummary">
                    <!-- è®¢å•ä¿¡æ¯ä¼šåŠ¨æ€æ˜¾ç¤º -->
                </div>
            </div>
            
            <!-- æ”¶è´§åœ°å€ -->
            <div class="checkout-section">
                <h3>æ”¶è´§åœ°å€</h3>
                <div class="address-info">
                    <div class="address-detail">
                        <span id="addressReceiver">æµªä½³æ€¡</span>
                        <span id="addressPhone">25216950207</span>
                    </div>
                    <div id="addressText">å¹¿ä¸œçœä½›å±±å¸‚å—æµ·åŒºç‹®å±±é•‡å¹¿ä¸œä¸œè½¯å­¦é™¢</div>
                </div>
            </div>
            
            <!-- æ”¯ä»˜æ–¹å¼ -->
            <div class="checkout-section">
                <h3>æ”¯ä»˜æ–¹å¼</h3>
                <div class="payment-options">
                    <div class="payment-option active" onclick="selectPayment('alipay')">
                        <div class="payment-icon">ğŸ’³</div>
                        <div class="payment-name">æ”¯ä»˜å®æ”¯ä»˜</div>
                        <div class="payment-selected">âœ“</div>
                    </div>
                    <div class="payment-option" onclick="selectPayment('wechat')">
                        <div class="payment-icon">ğŸ’°</div>
                        <div class="payment-name">å¾®ä¿¡æ”¯ä»˜</div>
                        <div class="payment-selected">âœ“</div>
                    </div>
                    <div class="payment-option" onclick="selectPayment('bank')">
                        <div class="payment-icon">ğŸ¦</div>
                        <div class="payment-name">é“¶è¡Œå¡æ”¯ä»˜</div>
                        <div class="payment-selected">âœ“</div>
                    </div>
                </div>
            </div>
            
            <!-- æ”¯ä»˜é‡‘é¢ -->
            <div class="checkout-section">
                <h3>æ”¯ä»˜é‡‘é¢</h3>
                <div class="price-details">
                    <div class="price-row">
                        <span>å•†å“é‡‘é¢</span>
                        <span>Â¥<span id="goodsAmount">0.00</span></span>
                    </div>
                    <div class="price-row">
                        <span>è¿è´¹</span>
                        <span>Â¥<span id="shippingFee">0.00</span></span>
                    </div>
                    <div class="price-row">
                        <span>ä¼˜æƒ </span>
                        <span>-Â¥<span id="discount">0.00</span></span>
                    </div>
                    <div class="price-total">
                        <span>å®ä»˜é‡‘é¢</span>
                        <span class="total-amount">Â¥<span id="totalAmount">0.00</span></span>
                    </div>
                </div>
            </div>
            
            <!-- æ”¯ä»˜æŒ‰é’® -->
            <div class="payment-section">
                <div class="agreement">
                    <input type="checkbox" id="agree" checked>
                    <label for="agree">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ã€Šå°å…”é²œå„¿æœåŠ¡åè®®ã€‹</label>
                </div>
                <button class="pay-btn" onclick="payNow()">ç«‹å³æ”¯ä»˜</button>
                <div class="payment-tips">
                    <p>æ”¯ä»˜æç¤ºï¼šè¯·åœ¨15åˆ†é’Ÿå†…å®Œæˆæ”¯ä»˜ï¼Œè¶…æ—¶è®¢å•å°†è‡ªåŠ¨å–æ¶ˆ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    <div class="footer">
        <div class="wrapper">
            <div class="top">
                <ul>
                    <li><span>ä»·æ ¼äº²æ°‘</span></li>
                    <li><span>å“è´¨æ–°é²œ</span></li>
                    <li><span>ç‰©æµå¿«æ·</span></li>
                </ul>
            </div>
            <div class="bottom">
                <p>
                    <a href="#">å…³äºæˆ‘ä»¬</a>|
                    <a href="#">å¸®åŠ©ä¸­å¿ƒ</a>|
                    <a href="#">å”®åæœåŠ¡</a>|
                    <a href="#">é…é€ä¸éªŒæ”¶</a>|
                    <a href="#">å•†åŠ¡åˆä½œ</a>|
                    <a href="#">æœç´¢æ¨è</a>|
                    <a href="#">å‹æƒ…é“¾æ¥</a>
                </p>
                <p>CopyRight @ å°å…”é²œå„¿</p>
            </div>
        </div>
    </div>

    <!-- æ”¯ä»˜æˆåŠŸå¼¹çª— -->
    <div class="modal-overlay" id="paymentModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ”¯ä»˜æˆåŠŸ</h3>
                <span class="close-btn" onclick="closeModal()">Ã—</span>
            </div>
            <div class="modal-body">
                <div class="success-icon">âœ“</div>
                <p class="success-text">æ”¯ä»˜æˆåŠŸï¼</p>
                <p>è®¢å•å·ï¼š<span id="orderNumber">DD202312341234</span></p>
                <p>æ”¯ä»˜é‡‘é¢ï¼š<span id="paidAmount">Â¥0.00</span></p>
                <p>é¢„è®¡24å°æ—¶å†…å‘è´§</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="viewOrder()">æŸ¥çœ‹è®¢å•</button>
                <button class="btn-primary" onclick="goHome()">è¿”å›é¦–é¡µ</button>
            </div>
        </div>
    </div>

    <script>
        let selectedPayment = 'alipay';
        let orderData = {};
        
        // é¡µé¢åŠ è½½æ—¶åŠ è½½è®¢å•æ•°æ®
        window.onload = function() {
            loadOrderData();
            renderOrderSummary();
        };
        
        // åŠ è½½è®¢å•æ•°æ®
        function loadOrderData() {
            // ä»localStorageè·å–è®¢å•æ•°æ®
            const savedCart = localStorage.getItem('cartForOrder');
            const savedTotal = localStorage.getItem('orderTotal');
            
            if (savedCart) {
                orderData.items = JSON.parse(savedCart);
            }
            
            if (savedTotal) {
                const goodsAmount = parseFloat(savedTotal);
                orderData.goodsAmount = goodsAmount;
                
                // è®¡ç®—è¿è´¹å’Œä¼˜æƒ 
                let shippingFee = 0;
                let discount = 0;
                
                if (goodsAmount < 99) {
                    shippingFee = 10;
                }
                
                if (goodsAmount >= 199) {
                    discount = 20;
                }
                
                orderData.shippingFee = shippingFee;
                orderData.discount = discount;
                orderData.totalAmount = goodsAmount + shippingFee - discount;
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤º
                document.getElementById('goodsAmount').textContent = goodsAmount.toFixed(2);
                document.getElementById('shippingFee').textContent = shippingFee.toFixed(2);
                document.getElementById('discount').textContent = discount.toFixed(2);
                document.getElementById('totalAmount').textContent = orderData.totalAmount.toFixed(2);
            }
            
            // ç”Ÿæˆè®¢å•å·
            orderData.orderNumber = 'DD' + Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // æ¸²æŸ“è®¢å•æ‘˜è¦
        function renderOrderSummary() {
            const orderSummary = document.getElementById('orderSummary');
            
            if (!orderData.items || orderData.items.length === 0) {
                orderSummary.innerHTML = '<p>æš‚æ— å•†å“ä¿¡æ¯</p>';
                return;
            }
            
            let html = '';
            orderData.items.forEach(item => {
                const itemTotal = item.price * item.quantity;
                html += `
                <div class="order-item">
                    <div class="item-name">${item.name}</div>
                    <div class="item-quantity">Ã—${item.quantity}</div>
                    <div class="item-price">Â¥${itemTotal.toFixed(2)}</div>
                </div>
                `;
            });
            
            orderSummary.innerHTML = html;
        }
        
        // é€‰æ‹©æ”¯ä»˜æ–¹å¼
        function selectPayment(payment) {
            selectedPayment = payment;
            
            // æ›´æ–°UI
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.payment-option').classList.add('active');
        }
        
        // ç«‹å³æ”¯ä»˜
function payNow() {
    const agree = document.getElementById('agree').checked;
    
    if (!agree) {
        alert('è¯·å…ˆåŒæ„æœåŠ¡åè®®');
        return;
    }
    
    // æ˜¾ç¤ºæ”¯ä»˜æˆåŠŸå¼¹çª—
    document.getElementById('paidAmount').textContent = 'Â¥' + orderData.totalAmount.toFixed(2);
    document.getElementById('orderNumber').textContent = orderData.orderNumber;
    document.getElementById('paymentModal').style.display = 'block';
    
    // æ¸…ç©ºè´­ç‰©è½¦
    localStorage.removeItem('cartItems');
    localStorage.removeItem('cartForOrder');
    localStorage.removeItem('orderTotal');
    
    // ä¿å­˜è®¢å•è®°å½•
    const orders = JSON.parse(localStorage.getItem('userOrders') || '[]');
    const newOrder = {
        orderNumber: orderData.orderNumber,
        orderTime: new Date().toLocaleString(),
        totalAmount: orderData.totalAmount,
        items: orderData.items,
        paymentMethod: selectedPayment,
        status: 'å·²æ”¯ä»˜'
    };
    orders.push(newOrder);
    localStorage.setItem('userOrders', JSON.stringify(orders));
    
    // ä¿å­˜è®¢å•é‡‘é¢ä¾› success.html ä½¿ç”¨
    localStorage.setItem('lastOrderAmount', orderData.totalAmount.toFixed(2));
    
    // 3ç§’åè‡ªåŠ¨è·³è½¬åˆ°æˆåŠŸé¡µé¢
    setTimeout(() => {
        window.location.href = `success.html?order=${orderData.orderNumber}`;
    }, 3000);
}
        
        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }
        
        // æŸ¥çœ‹è®¢å•
        function viewOrder() {
            closeModal();
            alert('è®¢å•è¯¦æƒ…åŠŸèƒ½å¾…å¼€å‘');
            // window.location.href = 'order-detail.html?order=' + orderData.orderNumber;
        }
        
        // è¿”å›é¦–é¡µ
        function goHome() {
            closeModal();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>